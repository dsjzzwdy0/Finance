(function($){$.createUploadIframe=function(id,uri){var frameId='jUploadFrame'+id;var iframeHtml='<iframe id="'+frameId+'" name="'+frameId+'" style="position:absolute; top:-9999px; left:-9999px"';if(window.ActiveXObject){if(typeof uri=='boolean'){iframeHtml+=' src="'+'javascript:false'+'"';}else if(typeof uri=='string'){iframeHtml+=' src="'+uri+'"';}}
iframeHtml+=' />';$(iframeHtml).appendTo(document.body);return $('#'+frameId).get(0);};$.createUploadForm=function(id,fileElementId,data){var formId='jUploadForm'+id,fileElementId=fileElementId.split(','),fileId,form=$('<form action="" method="POST" name="'+formId+'" id="'+formId+'" enctype="multipart/form-data"></form>'),oldElement;for(var item in fileElementId){oldElement=$('#'+fileElementId[item]);oldElement.eq(0).before(oldElement.clone(true).get(0));fileId='jUploadFile'+id+item;oldElement.attr('id',fileId).appendTo(form);}
if(data){for(var p in data){$("<input type='hidden' name='"+p+"' value='"+data[p]+"'/>").appendTo(form);}}
return form.css({'position':'absolute','top':'-1200px','left':'-1200px'}).appendTo('body');};$.ajaxFileUpload=function(s){var id=new Date().getTime();var form=$.createUploadForm(id,s.fileElementId,s.data);var io=$.createUploadIframe(id,s.secureuri);var frameId='jUploadFrame'+id;var formId='jUploadForm'+id;var requestDone=false;var xml={};var uploadCallback=function(isTimeout){var io=document.getElementById(frameId);try{if(io.contentWindow){xml.responseText=io.contentWindow.document.body?io.contentWindow.document.body.innerHTML:null;xml.responseXML=io.contentWindow.document.XMLDocument?io.contentWindow.document.XMLDocument:io.contentWindow.document;}else if(io.contentDocument){xml.responseText=io.contentDocument.document.body?io.contentDocument.document.body.innerHTML:null;xml.responseXML=io.contentDocument.document.XMLDocument?io.contentDocument.document.XMLDocument:io.contentDocument.document;}}catch(e){$.handleError(s,xml,null,e);}
if(xml||isTimeout=="timeout"){requestDone=true;var status;try{status=isTimeout!="timeout"?"success":"error";if(status!="error"){var data=$.uploadHttpData(xml,s.dataType);if(s.success)
s.success(data,status);}else
$.handleError(s,xml,status);}catch(e){status="error";}
if(s.complete)
s.complete(xml,status);$(io).unbind();setTimeout(function(){try{$(io).remove();$(form).remove();}catch(e){$.handleError(s,xml,null,e);}},100);xml=null;}};if(s.timeout>0){setTimeout(function(){if(!requestDone)uploadCallback("timeout");},s.timeout);}
try{var form=$('#'+formId);form.attr({'action':s.url,'method':'POST','target':frameId});if(form.encoding){form.attr('encoding','multipart/form-data');}else{form.attr('enctype','multipart/form-data');}
document.getElementById(formId).submit();}catch(e){$.handleError(s,xml,null,e);}
if(io.attachEvent){io.attachEvent("onload",function(){uploadCallback&&uploadCallback();});}else{io.onload=function(){uploadCallback&&uploadCallback();};}
return{abort:function(){}};};$.uploadHttpData=function(r,type){var data=!type;data=type=="xml"||data?r.responseXML:r.responseText;if(type=="script")
$.globalEval(data);if(type=="json"){if(/<pre/g.test(data)){eval("data = "+$(data).text());}else{data=data.replace(/[\r\n]+/g,"\\n");data=eval("("+data+")");}}
if(type=="html")
$("<div>").html(data).evalScripts();return data;};$.handleError=function(){};})($);function fnOkUploadPic(filePath,config){var oDefaultConfig={imgFormats:'jpg,jpeg,png',uploadPicBtnId:'okUploadPic',uploadPicUrl:'/I/?method=ok.user.comment.uploadItou',gaLabel:'上传投诉图片',picMaxSize:1024*1024*3,picMaxLength:4,callback:fnUploadPicSucc};config=$.extend(oDefaultConfig,config);var patern='';config.imgFormats.split(',').forEach(function(val,index){patern+='\\.'+val+'$|';});patern=new RegExp(patern.substr(0,patern.length-1),'i');if(patern.test(filePath)){var uploadPicBtnId=config.uploadPicBtnId,uploadPicUrl=config.uploadPicUrl,gaLabel=config.gaLabel,picMaxSize=config.picMaxSize,callback=config.callback,uploadPic=document.getElementById(uploadPicBtnId);if(uploadPic.files[0].size>picMaxSize){Common.LightBox.showMessage("图片文件过大，请重新选择！");return false;}
google_p([gaLabel]);$.ajaxFileUpload({url:uploadPicUrl,secureuri:false,fileElementId:uploadPicBtnId,dataType:'json',data:{},success:function(res,status){if(res.code>0){var data=res.info;if(callback&&typeof callback=='function')callback(data,config);}else{Common.LightBox.showMessage(res.msg);}},error:function(data,status,e){Common.LightBox.showMessage(e);}});}else{Common.LightBox.showMessage("请选择正确格式的图片进行上传!");}}
function fnUploadPicSucc(data,config){var uploadPicBtn=$('#'+config.uploadPicBtnId),picMaxLength=config.picMaxLength;var picHtml='<div class="upImgItem_box"> '+'<img src="'+data.domain+data.path+'" alt="投诉图片" data-path="'+data.path+'"> '+'<a href="javascript:void(0)" class="complain_delbtn deletPicBtn" ></a></div>';uploadPicBtn.val('').parent().before(picHtml);var uploadedPicsNum=uploadPicBtn.parent().siblings().size(),uploadedPicBox=uploadPicBtn.parent();if(uploadedPicsNum==picMaxLength){uploadedPicBox.hide();uploadPicBtn.prop('disabled',true);}else{if(uploadedPicBox.is(':hidden')){uploadedPicBox.show();uploadPicBtn.prop('disabled',false);}}
$('.deletPicBtn').unbind('click').bind('click',function(){$(this).parent().remove();uploadedPicBox.show();uploadPicBtn.prop('disabled',false);})}